<!DOCTYPE html>
<html>
<head>
<link rel="icon" type="image/vnd.microsoft.icon"
	 href="https://mark4pro.github.io/LineBattle/icon/favicon.ico" />
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<link rel="apple-touch-icon" href="https://mark4pro.github.io/LineBattle/icon/Line_Battle_icon.png" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"/>
<title>Line Battle V5</title>
<style>
body {
margin: 0;
background-color: black;
position: fixed;
touch-action: none;
}
canvas {
border:1px solid #d3d3d3;
background-color: #f1f1f1;
position: fixed;
display: none;
}
.unselectable {
   -moz-user-select: -moz-none;
   -khtml-user-select: none;
   -webkit-user-select: none;
   -ms-user-select: none;
   user-select: none;
}
</style>
</head>
<body id="BGColor" onload="startGame()">
<canvas id="canvas" style="border:0px;touch-action:none;"></canvas>
<button id="pauseG" style="touch-action:none;cursor:pointer;color:black;background-color:purple;border:0px;width:80px;height:50px;font:15px Arial;text-align:center;position:fixed;right:0.5%;top:3%;opacity:0.5;display:none;">PAUSE</button>
<button id="blueBttn" style="cursor:pointer;color:black;background-color:blue;border:0px;width:80px;height:50px;font:30px Arial;text-align:center;position:fixed;opacity:0.5;display:none;"></button>
<button id="redBttn" style="cursor:pointer;color:black;background-color:red;border:0px;width:80px;height:50px;font:30px Arial;text-align:center;position:fixed;opacity:0.5;display:none;"></button>
<button id="winBttn" style="cursor:pointer;color:white;background-color:magenta;border:0px;width:180px;height:50px;font:30px Arial;text-align:center;position:fixed;opacity:0.5;display:none;"></button>
<h1 unselectable="on" class="unselectable" id="welcome" style="touch-action:none;color:blue;text-align:center;font:36px Arial;width:500px;position:fixed;right:50%;left:50%;top:10%;transform:translate(-50%,-50%);"><b>Welcome To Line Battle!</b></h1>
<button id="startG" style="touch-action:none;cursor:pointer;color:red;background-color:blue;border:0px;width:200px;height:50px;font:30px Arial;text-align:center;position:fixed;right:50%;left:50%;top:20%;transform:translate(-50%,-50%);">PLAY</button>
<div id="BGT"><p unselectable="on" class="unselectable" style="touch-action:none;color:red;position:fixed;right:50%;left:45.5%;top:30%;transform:translate(-50%,-50%);">Red<input type="range" min="0" max="255" value="0" id="red" style="outline:none;cursor:pointer;width:250px;height:25px;background:red;"></p>
<p unselectable="on" class="unselectable" style="touch-action:none;color:green;position:fixed;right:50%;left:45.5%;top:40%;transform:translate(-50%,-50%);">Green<input type="range" min="0" max="255" value="0" id="green" style="outline:none;cursor:pointer;width:250px;height:25px;background:green;"></p>
<p unselectable="on" class="unselectable" style="touch-action:none;color:blue;position:fixed;right:50%;left:45.5%;top:50%;transform:translate(-50%,-50%);">Blue<input type="range" min="0" max="255" value="0" id="blue" style="outline:none;cursor:pointer;width:250px;height:25px;background:blue;"></p>
<p unselectable="on" class="unselectable" style="touch-action:none;color:blue;position:fixed;right:50%;left:43.2%;top:57%;width:200px;">Tail Length<input type="range" min="0" max="500" value="100" id="tail" style="outline:none;cursor:pointer;width:250px;height:25px;"></p>
<p unselectable="on" class="unselectable" id="waveNum" style="touch-action:none;color:blue;position:fixed;right:50%;left:43.5%;top:65%;width:200px;"></p>
<p unselectable="on" class="unselectable" style="touch-action:none;color:blue;position:fixed;right:50%;left:45.5%;top:70%;transform:translate(-50%,-50%);"><input type="range" min="1" max="50" value="10" id="wave" style="outline:none;cursor:pointer;width:250px;height:25px;"></p></div>
<script>
var keys = {};
window.addEventListener("keydown",
    function(e){
        keys[e.keyCode] = true;
        switch(e.keyCode){
            case 37: case 39: case 38:  case 40: // Arrow keys
            case 32: e.preventDefault(); break; // Space
            default: break; // do not block other keys
        }
    },
false);
window.addEventListener('keyup',
    function(e){
        keys[e.keyCode] = false;
    },
false);

startG.onclick = function() {
pause = false;
startG.style.display = "none";
BGT.style.display = "none";
};

pauseG.onclick = function() {
pause = true;
startG.style.display = "initial";
BGT.style.display = "initial";
};

var start = 1;
function startGame() {
Player1 = new component("player1", 30, 30, "blue", 50, 120, "cir");
Player2 = new component("player2", 30, 30, "red", window.innerWidth - 50, window.innerHeight - 120, "cir");
background = new component("", 10000000, 10000000, "white", 100, 0, "rec");
GameArea.start();
}

var pause = true;
var blueBttn = document.getElementById("blueBttn");
var redBttn = document.getElementById("redBttn");
var winBttn = document.getElementById("winBttn");
var GameArea = {
start : function() {
var canvas = document.getElementById('canvas');
this.context = canvas.getContext("2d");
document.body.insertBefore(canvas, document.body.childNodes[0]);
this.interval = setInterval(updateGameArea, 10);
window.addEventListener('mousedown', function (e) {
GameArea.x = e.pageX;
GameArea.y = e.pageY;
})
window.addEventListener('mouseup', function (e) {
GameArea.x = false;
GameArea.y = false;
})
window.addEventListener('touchstart', function (e) {
GameArea.x = e.pageX;
GameArea.y = e.pageY;
})
window.addEventListener('touchend', function (e) {
GameArea.x = false;
GameArea.y = false;
})
}, 
updateCV : function(){
this.context.clearRect(0, 0, canvas.width, canvas.height);
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;
background.width = canvas.width * 2;
background.height = canvas.height * 2;
background.x = 0;
background.y = 0;
winBttn.style.top = canvas.height / 2 - 50 / 2 + "px";
winBttn.style.left = canvas.width / 2 - 180 / 2 + "px";
blueBttn.style.top = "15px";
blueBttn.style.left = "15px";
redBttn.style.bottom = "15px";
redBttn.style.right = "15px";
if (pause == true) {
GameArea.pause();
}
if (pause == false) {
GameArea.unpause();
 }
},
pause : function(){
canvas.style.display = "none";
pauseG.style.display = "none";
},
unpause : function(){
canvas.style.display = "initial";
pauseG.style.display = "initial";
}
}

var _bullets = [];
function component(name, width, height, color, x, y, type, id, timeAlive) {
this.type = type;
this.color = color;
this.width = width;
this.height = height;
this.id = id;
this.name = name;
this.text = name;
this.speed = 0;
this.angle = 0;
this.moveAngle = 0;
this.dead = false;
this.points = 0;
this.radius = 25;
this.bullRadius = 5;
this.timeAlive = timeAlive;
this.x = x;
this.y = y;	
this.update = function() {
ctx = GameArea.context;
if (this.type == "text") {
  ctx.font = this.font;
  ctx.fillStyle = color;
  ctx.fillText(this.text, this.x, this.y);
  } 
  if (this.type == "rec") {
  ctx.save();
  ctx.translate(this.x, this.y);
  ctx.rotate(this.angle);
  ctx.fillStyle = this.color;
  ctx.fillRect(this.width / -2, this.height / -2, this.width, this.height);
  ctx.restore();	
  }
  if (this.type == "Bull") {
  ctx.beginPath();
  ctx.arc(this.x, this.y, this.bullRadius, 0, 2 * Math.PI, true);
  ctx.fillStyle = this.color;
  ctx.fill();	
  }
  if (type == "cir") {
  ctx.beginPath();
  ctx.arc(this.x, this.y, this.radius, 0, 2 * Math.PI, true);
  ctx.fillStyle = this.color;
  ctx.fill();
  ctx.lineWidth = 0;
  ctx.strokeStyle = 0;
  ctx.stroke();
 }
if (this.type == "Bull") {
this.timeAlive += 0.2;
 }
}
this.newPos = function() {
this.angle += this.moveAngle * Math.PI / 180;
this.x += this.speed * Math.sin(this.angle);
this.y -= this.speed * Math.cos(this.angle);
}
this.clicked = function() {
var myleft = this.x;
var myright = this.x + (this.width);
var mytop = this.y;
var mybottom = this.y + (this.height);
var clicked = true;
if (startgame == 0) {
Player1.speed = 0;
Player2.speed = 0; 
Player1.angle += 1 * Math.PI / -180; 
Player2.angle += 1 * Math.PI / 180;   
}
if ((mybottom < GameArea.y) || (mytop > GameArea.y) || (myright < GameArea.x) || (myleft > GameArea.x)) {
clicked = false;
}
return clicked;
}
if (name == "player1") {
this.shoot = function(){
if(this.dead === false){
var __bullet = new component("", 5, 5, "darkblue", Player1.x, Player1.y + 10, "Bull", "Tank1", 0);
_bullets.push(__bullet);
}
   }
  } else
  if (name == "player2") {
this.shoot = function(){
if(this.dead === false){
var __bullet = new component("", 5, 5, "darkred", Player2.x, Player2.y + 10, "Bull", "Tank2", 0);
_bullets.push(__bullet);
}
   }
  }
  this.circleCrashWith = function(otherobj) {
var distance_x = this.x - otherobj.x;
var distance_y = this.y - otherobj.y;
var rSum = this.radius + otherobj.radius;
if (distance_x * distance_x + distance_y * distance_y <= rSum * rSum) { 
return true;
} else {
return false;
 }
}
}
var startgame = 0;
var startmove2 = 0;
var dirSwitch = 0;
var dirSwitch2 = 0;
var lock = 0;
var lock2 = 0;
var win = false;
var tankReset = 0;
function updateGameArea() {
var numOfWaves = document.getElementById('wave').value;
var lineLength = document.getElementById('tail').value;
var redC = document.getElementById('red').value;
var greenC = document.getElementById('green').value;
var blueC = document.getElementById('blue').value;
document.getElementById('waveNum').innerHTML = "Number Of Waves: " + numOfWaves;
BGColor.style.backgroundColor = "rgb("+redC+", "+greenC+", "+blueC+")";
blueBttn.innerHTML = Player1.points;
redBttn.innerHTML = Player2.points;
if (start == 1 && pause == false) {
start = 0;
document.getElementById('welcome').style.display = "none";
}
GameArea.updateCV();
if (pause == false) {
blueBttn.style.display = "initial";
redBttn.style.display = "initial";
} else {
blueBttn.style.display = "none";
redBttn.style.display = "none";
}
for(var u = _bullets.length - 1; u >= 0; u--) {
if (_bullets[u].id == "Tank1" && _bullets[u].timeAlive >= lineLength) {
_bullets.shift();

}
}
if (Player1.dead == false || Player2.dead == false && pause == false) {
Player1.speed = -3;
Player2.speed = 3;
Player1.shoot();
Player2.shoot();
}
if (button_down == true && pause == false) {
if (dirSwitch == 0) {
Player1.angle += 3 * Math.PI / 180; 
}
if (dirSwitch == 1) {
Player1.angle += 3 * Math.PI / -180; 
}
if (lock == 0) {
dirSwitch += 1;
lock = 1;
}
}
if (button_down == false) {
startgame = 1;
lock = 0;
}
if (button2_down == true && pause == false) {
if (dirSwitch2 == 0) {
Player2.angle += 3 * Math.PI / 180;   
}
if (dirSwitch2 == 1) {
Player2.angle += 3 * Math.PI / -180;   
}
if (lock2 == 0) {
dirSwitch2 += 1;
lock2 = 1;
}
}
if (button2_down == false) {
startgame = 1;
lock2 = 0;
}
if (Player1.y <= 5) {
Player1.y += window.innerHeight - 5;
}
if (Player1.y >= window.innerHeight - 5) {
Player1.y -= window.innerHeight - 5;
}
if (Player1.x <= 0) {
Player1.x += window.innerWidth;
}
if (Player1.x >= window.innerWidth) {
Player1.x -= window.innerWidth;
}
if (Player2.y <= 5) {
Player2.y += window.innerHeight - 5;
}
if (Player2.y >= window.innerHeight - 5) {
Player2.y -= window.innerHeight - 5;
}
if (Player2.x <= 0) {
Player2.x += window.innerWidth;
}
if (Player2.x >= window.innerWidth) {
Player2.x -= window.innerWidth;
}
for(var j = _bullets.length - 1; j >= 0; j--) {
if (_bullets[j].id == "Tank2" && Player1.dead === false && Player1.circleCrashWith(_bullets[j]) && win == false) {
_bullets.splice(j, 1);
Player1.dead = true;
Player2.points++;
}
}
for(var k = _bullets.length - 1; k >= 0; k--) {
if (_bullets[k].id == "Tank1" && Player2.dead === false && Player2.circleCrashWith(_bullets[k]) && win == false) {
_bullets.splice(k, 1);
Player2.dead = true;
Player1.points++;
}
}
if (win == true) {
if (pause == 0) {
winBttn.style.display = "initial";
 }
} else {
winBttn.style.display = "none";
}
if (Player1.dead) {
tankReset++;
Player1.color = "grey";
Player1.speed = 0;
Player1.angle = 0;
Player2.speed = 0;
Player2.angle = 0;
dirSwitch = 0;
dirSwitch2 = 0;
button_down = false;
button2_down = false;
button3_down = false;
_bullets.length = 0;
if (tankReset > 50) {
deathReset();
 }
}
if (Player1.dead == false && Player2.dead == false) {
tankReset = 0;
}
if (Player2.dead) {
tankReset++;
Player2.color = "grey";
Player2.speed = 0;
Player2.angle = 0;
Player1.speed = 0;
Player1.angle = 0;
dirSwitch = 0;
dirSwitch2 = 0;
button_down = false;
button2_down = false;
button3_down = false;
_bullets.length = 0;
if (tankReset > 50) {
deathReset();
 }
}
background.update();
if (dirSwitch  > 1) {
dirSwitch = 0;
}
if (dirSwitch2  > 1) {
dirSwitch2 = 0;
}
for (var i = _bullets.length - 1; i >= 0; i--){
_bullets[i].update();
if (_bullets[i].x <= 0 || _bullets[i].x >= window.innerWidth || _bullets[i].y >= window.innerHeight || _bullets[i].y <= 0){
 _bullets.splice(i, 1);
}
   }
Player1.update();
Player1.newPos();
Player2.update();
Player2.newPos();
if(Player1.circleCrashWith(Player2)){
if(Player1.x < Player2.x){
 Player1.x = Player1.x - 1;
 Player1.y = Player1.y - 1;
 Player2.x = Player2.x + 1;
 Player2.y = Player2.y + 1;
}
else if(Player1.x > Player2.x){
 Player1.x = Player1.x + 1;
 Player1.y = Player1.y + 1;
 Player2.x = Player2.x - 1;
 Player2.y = Player2.y - 1;
}
  }
  if (Player1.points >= numOfWaves && Player2.points < numOfWaves) {
winBttn.innerHTML = "Blue Wins!";
win = true;
 }
  if (Player2.points >= numOfWaves && Player1.points < numOfWaves) {
winBttn.innerHTML = "Red Wins!";
win = true;
 }
  if (Player1.points >= numOfWaves && Player2.points >= numOfWaves) {
winBttn.innerHTML = "Tie!";
win = true;
 }
background.color = "rgb("+redC+", "+greenC+", "+blueC+")";
if (win == true && button3_down == true) {
	winReset();
 }
}

function deathReset() {
if (Player1.dead == true) {
 Player1.dead = false;
 Player1.color = "blue";
 Player1.x = 50;
 Player1.y = 120;
 Player2.x = window.innerWidth - 50;
 Player2.y = window.innerHeight - 120;
 Player1.speed = 0;
 Player2.speed = 0;
 }
if (Player2.dead == true) {
 Player2.dead = false;
 Player2.color = "red";
 Player1.x = 50;
 Player1.y = 120;
 Player2.x = window.innerWidth - 50;
 Player2.y = window.innerHeight - 120;
 Player1.speed = 0;
 Player2.speed = 0;
 }
}

function winReset() {
if (win == true) {
 _bullets.length = 0;
 dirSwitch = 0;
 dirSwitch2 = 0;
 button_down = false;
 button2_down = false;
 Player1.angle = 0;
 Player2.angle = 0;
 Player1.dead = false;
 Player2.dead = false;
 Player1.points = 0;
 Player2.points = 0;
 Player1.color = "blue";
 Player2.color = "red";
 Player1.x = 50;
 Player1.y = 120;
 Player2.x = window.innerWidth - 50;
 Player2.y = window.innerHeight - 120;
 Player1.speed = 0;
 Player2.speed = 0;
 win = false;
 }
} setTimeout(winReset, 1000);

var button_down = false, button2_down = false, button3_down = false;

blueBttn.onmousedown = function() {button_down = true; blueBttn.style.backgroundColor = "darkblue";}
blueBttn.onmouseup = function() {button_down = false; blueBttn.style.backgroundColor = "blue";}
redBttn.onmousedown = function() {button2_down = true; redBttn.style.backgroundColor = "darkred";}
redBttn.onmouseup = function() {button2_down = false; redBttn.style.backgroundColor = "red";}
winBttn.onmousedown = function() {button3_down = true; winBttn.style.backgroundColor = "purple";}
winBttn.onmouseup = function() {button3_down = false; winBttn.style.backgroundColor = "magenta";}

document.onkeydown = function(e) {
switch (e.keyCode) {
case 87:
		button_down = true; 
		blueBttn.style.backgroundColor = "darkblue";		
			break;
		case 38:
		button2_down = true;
		redBttn.style.backgroundColor = "darkred";		
			break;
}
};
document.onkeyup = function(e) {
switch (e.keyCode) {
case 87:
		button_down = false;  
		blueBttn.style.backgroundColor = "blue";		
			break;
		case 38:
		button2_down = false;
		redBttn.style.backgroundColor = "red";		
			break;
}
};
</script>
</body>
</html>
