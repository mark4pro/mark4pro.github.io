<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"/>
<title>test</title>
<style>
body {
	margin: 0;
	background-color: black;
	position: fixed;
	
}
canvas {
	background-color: white;
	position: fixed;
	image-rendering: -moz-crisp-edges;		 /* Firefox */
	image-rendering: -webkit-crisp-edges;	  /* Webkit */
	-ms-interpolation-mode: nearest-neighbor;  /* IE (non-standard property) */
	image-rendering: crisp-edges;				/* Chrome */
}
.unselectable {
   -moz-user-select: -moz-none;
   -khtml-user-select: none;
   -webkit-user-select: none;
   -ms-user-select: none;
   user-select: none;
}
</style>
</head>
<body onload="start()">
<canvas id="canvas" style="border:0px;"></canvas>
<script>
var keys = {};
window.addEventListener("keydown",
    function(e){
        keys[e.keyCode] = true;
        switch(e.keyCode){
            case 37: case 39: case 38:  case 40: // Arrow keys
            case 32: e.preventDefault(); break; // Space
            default: break; // do not block other keys
        }
    },
false);
window.addEventListener('keyup',
    function(e){
        keys[e.keyCode] = false;
    },
false);

var playerX = 384.5;
var playerY = 183;
var playerSpeedX = 0;
var playerSpeedY = 0;
function start() {
 box = new component(32, 32, "grey", playerX, playerY, "player1", "false");
 Board.start();
 updateGameArea();
 }
 
var Board = {
canvas : document.getElementById("canvas"),
start : function() {
this.context = this.canvas.getContext("2d");
document.body.insertBefore(this.canvas,
document.body.childNodes[0]);
this.interval = setInterval(updateGameArea, 10);
		document.addEventListener("keydown",keyDownHandler, false);	
		document.addEventListener("keyup",keyUpHandler, false);
},
stop : function() {
        clearInterval(this.interval);
},
clear : function() {
this.context.clearRect(0, 0, this.canvas.width, this.canvas.height);
this.canvas.width = window.innerWidth;
this.canvas.height = window.innerHeight - 5;
},
}

function component(width, height, color ,x ,y, type, radius, outcolor, thickness) {
this.type = type;
this.speedX = 0;
this.speedY = 0;
this.x = x;
this.y = y;
this.angle = 0;
this.width = width;
this.height = height;
this.halfWidth = this.width * 0.5;
this.halfHeight = this.height * 0.5;
this.color = color;
this.update = function() {
ctx = Board.context;
if (this.type == "text") {
 ctx.font = this.font;
 ctx.fillStyle = this.color;
 ctx.fillText(this.text, this.x, this.y);
} else {
if (this.type == "rec" || this.type == "player1") {
this.rotateLock = radius;
if (this.rotateLock == "") {
this.rotateLock = "true";
}
if (this.rotateLock == "false") {
ctx.save();
ctx.translate(this.x, this.y);
ctx.rotate(this.angle);
ctx.fillStyle = this.color;
ctx.fillRect(this.width / -2, this.height / -2, this.width, this.height);
ctx.restore();
}
if (this.rotateLock == "true") {
ctx.save();
ctx.fillStyle = this.color;
ctx.fillRect(this.x, this.y, this.width, this.height);
ctx.restore();
}
  }
 }
 if (this.type == "cir") {
 this.thickness = thickness;
 this.outcolor = outcolor;
 this.radius = radius;
 ctx.beginPath();
 ctx.arc(this.x, this.y, radius, 0, 2 * Math.PI, true);
 ctx.fillStyle = this.color;
 ctx.fill();
 ctx.lineWidth = thickness;
 ctx.strokeStyle = outcolor;
 ctx.stroke();
 } else {
 if (type == "img") {
 ctx.save();
 ctx.translate(this.x, this.y);
 ctx.rotate(this.angle);
 var img = document.getElementById("Rectangle");
 ctx.drawImage(img, this.width / -2, this.height / -2, this.width, this.height);
 ctx.restore();
  }
 }
}
this.newPos = function() {
this.x += this.speedX;
this.y += this.speedY;
}
this.getMidX = function() {
 return this.halfWidth + this.x;
},
this.getMidY = function() {
 return this.halfHeight + this.y;
},
this.getTop = function() {
 return this.y;
},
this.getLeft = function() {
 return this.x;
},
this.getRight = function() {
 return this.x + this.width;
},
this.getBottom = function() {
 return this.y + this.height;
}
this.crashWith = function(otherobj) {
var l1 = this.getLeft();
var t1 = this.getTop();
var r1 = this.getRight();
var b1 = this.getBottom();
var l2 = otherobj.getLeft();
var t2 = otherobj.getTop();
var r2 = otherobj.getRight();
var b2 = otherobj.getBottom();
var crash = true;
if (b1 < t2 || t1 > b2 || r1 < l2 || l1 > r2) {
 crash = false;
}
 return crash;
if (crash == true) {
console.log("test");
this.elasticCollition(otherobj);
 }
};
this.elasticCollition = function(entity) {
    var pMidX = this.getMidX();
    var pMidY = this.getMidY();
    var aMidX = entity.getMidX();
    var aMidY = entity.getMidY();
    var dx = (aMidX - pMidX) / entity.halfWidth;
    var dy = (aMidY - pMidY) / entity.halfHeight;
    var absDX = Math.abs(dx);
    var absDY = Math.abs(dy);
    if (absDX > absDY) {
        if (dx < 0) {
		this.x = entity.getRight() + 0.5;
			if (this.type == "player1") {
				if (lockLeftE == 1) {
				playerSpeedX = 0;
				}
			}
        } else {
		this.x = entity.getLeft() - this.width - 0.5;
			if (this.type == "player1") {
			   if (lockRightE == 1) {
				playerSpeedX = 0;
				}
		    }
        }		
    } else {
        if (dy < 0) {
		this.y = entity.getBottom() + 0.5;
			if (this.type == "player1") {
				if (lockUpE == 1) {
					playerSpeedY = 0;
			}
		}
    } else {
		this.y = entity.getTop() - this.height - 0.5;
			if (this.type == "player1") {
			    if (lockDownE == 1) {
					playerSpeedY = 0;
			    }
			}
        }  
    }
 }
}

var mouseX = 0;
var mouseY = 0;
window.addEventListener("mousemove", function(event) {
mouseX = event.clientX;
mouseY = event.clientY;
});

function updateGameArea() {
Board.clear();
box.update();
box.newPos();
var rX = -box.x + mouseX;
var rY = -box.y + mouseY;
box.angle = Math.atan2(rY,rX);
box.speedY = playerSpeedY;
box.speedX = playerSpeedX;
if (up == 1 && down == 0 && left == 0 && right == 0) {
 if (playerSpeedY >= -3) {
 playerSpeedY -= 0.05;
 } else {
 playerSpeedY = -3;
  }
}
if (up == 1 && down == 0 && left == 1 && right == 0) {
 if (playerSpeedY >= -1.8) {
 playerSpeedY -= 0.05;
 } else {
 playerSpeedY = -1.8;
  }
 if (playerSpeedX >= -1.8) {
 playerSpeedX -= 0.05;
 } else {
 playerSpeedX = -1.8;
  }
}
if (up == 1 && down == 0 && left == 0 && right == 1) {
 if (playerSpeedY >= -1.8) {
 playerSpeedY -= 0.05;
 } else {
 playerSpeedY = -1.8;
  }
 if (playerSpeedX <= 1.8) {
 playerSpeedX += 0.05;
 } else {
 playerSpeedX = 1.8;
  }
}
if (upE == 1 && up == 0) {
if (playerSpeedY >= -4) {
playerSpeedY += 0.08;
 }
if (playerSpeedY >= 0) {
playerSpeedY = 0;
upE = 0;
  }
}
if (down == 1 && up == 0 && left == 0 && right == 0) {
 if (playerSpeedY <= 3) {
 playerSpeedY += 0.05;
 } else {
 playerSpeedY = 3;
  }
}
if (down == 1 && up == 0 && left == 1 && right == 0) {
 if (playerSpeedY <= 1.8) {
 playerSpeedY += 0.05;
 } else {
 playerSpeedY = 1.8;
  }
 if (playerSpeedX >= -1.8) {
 playerSpeedX -= 0.05;
 } else {
 playerSpeedX = -1.8;
  }
}
if (down == 1 && up == 0 && left == 0 && right == 1) {
 if (playerSpeedY <= 1.8) {
 playerSpeedY += 0.05;
 } else {
 playerSpeedY = 1.8;
 }
 if (playerSpeedX <= 1.8) {
 playerSpeedX += 0.05;
 } else {
 playerSpeedX = 1.8;
  }
}
if (downE == 1 && down == 0) {
if (playerSpeedY <= 4) {
playerSpeedY -= 0.08;
 }
if (playerSpeedY <= 0) {
playerSpeedY = 0;
downE = 0;
  }
}
if (left == 1 && right == 0 && up == 0 && down == 0) {
 if (playerSpeedX >= -3) {
 playerSpeedX -= 0.05;
 }
 if (playerSpeedX <= -3) {
 playerSpeedX = -3;
  }
}
if (leftE == 1 && left == 0 && right == 0) {
if (playerSpeedX >= -4) {
playerSpeedX += 0.08;
 }
if (playerSpeedX >= 0) {
playerSpeedX = 0;
leftE = 0;
  }
}
if (right == 1 && left == 0 && up == 0 && down == 0) {
 if (playerSpeedX <= 3) {
 playerSpeedX += 0.05;
 }
 if (playerSpeedX >= 3) {
 playerSpeedX = 3;
  }
}
if (rightE == 1 && right == 0 && left == 0) {
if (playerSpeedX <= 4) {
playerSpeedX -= 0.08;
 }
if (playerSpeedX <= 0) {
playerSpeedX = 0;
rightE = 0;
  }
}
if (up == 0 && playerSpeedY <= 0) {
	lockUpE = 0;
}
if (down == 0 && playerSpeedY <= 0) {
	lockDownE = 0;
}
if (left == 0 && playerSpeedX <= 0) {
	lockLeftE = 0;
}
if (right == 0 && playerSpeedX <= 0) {
	lockRightE = 0;
}
}

function keyDownHandler(event)
{
	var keyPressed = String.fromCharCode(event.keyCode);

	if (keyPressed == "W")
	{		
            moveUp();
	}
	else if (keyPressed == "S")
	{	
            moveDown();		
	}
	else if (keyPressed == "A")
	{	
            moveLeft();	
	}
	else if (keyPressed == "D")
	{	
            moveRight();	
	}
}

function keyUpHandler(event)
{
	var keyPressed = String.fromCharCode(event.keyCode);
	
	if (keyPressed == "W")
	{		
		clearmoveu();
	}
	else if (keyPressed == "S")
	{	
		clearmoved();		
	}
	else if (keyPressed == "A")
	{	
		clearmovel();		
	}
	else if (keyPressed == "D")
	{	
		clearmover();		
	}
}

var upE = 0;
var downE = 0;
var leftE = 0;
var rightE = 0;
var lockUpE = 0;
var lockDownE = 0;
var lockLeftE = 0;
var lockRightE = 0;
var up = 0;
var down = 0;
var left = 0;
var right = 0;
function moveUp() {
up = 1;
upE = 1;
lockUpE = 1;
}
function moveDown() {
down = 1;
downE = 1;
lockDownE = 1;
}
function moveLeft() {
left = 1;
leftE = 1;
lockLeftE = 1;
}
function moveRight() {
right = 1;
rightE = 1;
lockRightE = 1;
}
function clearmoveu() {
if (upE > 0) {
 up = 0;
 }
}
function clearmoved() {
lockDownE = 0;
if (downE > 0) {
 down = 0;
 }
}
function clearmovel() {
lockLeftE = 0;
if (leftE > 0) {
 left = 0;
 }
}
function clearmover() {
lockRightE = 0;
if (rightE > 0) {
 right = 0;
 }
}
</script>
</body>
</html>
