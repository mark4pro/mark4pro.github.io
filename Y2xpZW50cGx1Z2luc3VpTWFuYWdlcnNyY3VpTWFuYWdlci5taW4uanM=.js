/** Copyright (c) 2016 WIMI5. All rights reserved. */ (function(){var e=void 0,n=this;function v(c){c=c.split(".");var g=n;!(c[0]in g)&&g.execScript&&g.execScript("var "+c[0]);for(var h;c.length&&(h=c.shift());)g=g[h]?g[h]:g[h]={}}Math.random();v("PENGO.client.plugins.uiManager.model");window.PENGO.client.plugins.uiManager.model.resolve=function(c){return{A:c.bbWrappers.pengoModel.PengoModel.extend({defaults:function(){return{_id:e,texts:e}},X:function(){}})}};v("PENGO.client.plugins.uiManager.errors");window.PENGO.client.plugins.uiManager.errors.resolve=function(c){return{O:e,G:{"md:lang#1":{msg:!1,code:c.pengoError.codes.codes.NOT_FOUND}}}};v("PENGO.client.plugins.uiManager.module");
window.PENGO.client.plugins.uiManager.module.resolve=function(c,g){function h(f,a){var b=this;this.F=this.f=e;this.z=f;this.P=a;this.W=this.V=this.U=this.view=this.n=this.b=this.aa=this.g=this.a=this.d=this.e=this.R=this.Q=this.j=this.i=e;this.N=function(a){switch(a.get("view").model.id){case "PENGO.client.plugins.dashboard.userManager.module.Module":b.view.$el.find(".UserView .content").html(a.get("view").el)}};this.I=function(a){switch(a.get("view").model.id){case "PENGO.client.plugins.dashboard.userManager.module.Module":b.view.$el.find(".UserView .content").find(a.get("view").el).remove()}};h.super_.constructor.call(this,
this.N,this.I);this.r=function(a){b.view.r(a)};this.c=function(){b.view.c()};this.h=function(a){b.view.h(a)};this.s=function(){b.view.s()};this.l=function(){b.view.l()};this.q=function(a){b.b.q(a)};this.k=function(a){b.b.k(a)};this.t=function(a){b.view.t(a)}}var k={};h.prototype={L:function(f,a){this.f=f;a&&a.type&&(this.f.type=a.type);this.F=f.errorsStore},o:function(f){this.d=f;return this.d!==e},M:function(f){this.toolbar=f;return this.toolbar!==e},p:function(f){this.support=f;return this.support!==
e},w:function(f){if(f===e){if(this.a!==e){try{this.a.removeEvents(k)}catch(a){this.e.warn("Error '"+a+"' while removing events changing events manager")}this.a.off("LANGUAGE_UPDATED",this.u);this.T=e}}else this.a=f,this.a.on("LANGUAGE_UPDATED",this.u,this),this.a.registerEvents(k)},start:function(f,a,b,d,r,q,m){this.e=a;h.super_.setLogger.call(this,a);this.g=r;this.o(b);this.v(function(a,b){a||(this.i=b,this.B(f),this.n=new g.model.A({_id:"PENGO.client.plugins.uiManager.module.Module",texts:b}),this.b=
g.controller(this),this.w(d),this.j=g.view.H(this,this.z),this.view=new this.j({model:this.n,viewsMgr:(new c.bbWrappers.viewsManager.ViewsManager).addCallback(this.b.K)}),$("#pengoApp").append(this.view.$el));c.util.callback.call(q,m||this,a)},this)},stop:function(){this.view!==e&&(this.view.remove(),this.view=e);this.j=e;this.w(e);this.i=this.n=this.b=e;this.o(e);this.e=e},v:function(f,a){this.d===e||null===this.d||this.d.getTexts(this.P,f,a||this)},u:function(){this.v(function(f,a){!f&&this.view!==
e&&(this.i=a)},this)},B:function(f){var a=this;this.g.setHandler(function(b){function d(){switch(a.f.type){case "chromews":window.chrome&&window.chrome.runtime.reload();break;default:window.location.reload()}}$("#pengoApp").children(":not(.UiManager)").remove();$("#pengoApp .UiManager").children(":not(#ModalView)").remove();var c="",g;for(g in b)c+=g+": "+b[g]+"\n";f?window.alert&&window.alert(c):(a.support&&a.support.sendFatalEvent({stack:c}),a.h({dialogClass:"light error-game",title:"Oops! ",text:"Something uncontrolled happend to the game. Reload the game and <span>continue having fun</span>.",
extra:'<div class="modal-form-field center">More details <i class="icon-caret-right"></i></div><div class="modal-form-field block error-text hidden-ghost">'+c+"</div>",button1Text:"Report the bug",button2Text:"Reload the game",closeButtonAction:function(){d()},button2Action:function(){d()},button1Action:function(){try{a.support?a.support.sendFatalReport({stack:c},function(b){b&&a.e.error(b);d()}):d()}catch(b){a.e.error("Unexpected error '"+b+" while posting to '"+a.f.errorsURL+"'"),d()}},extraActions:[{extraSel:".icon-caret-right",
extraAct:function(){var a=$(this);a.hasClass("icon-caret-right")?(a.removeClass("icon-caret-right"),a.addClass("icon-caret-down"),a.parent().next(".modal-form-field.block.error-text").removeClass("hidden-ghost")):a.hasClass("icon-caret-down")&&(a.removeClass("icon-caret-down"),a.addClass("icon-caret-right"),a.parent().next(".modal-form-field.block.error-text").addClass("hidden-ghost"))}}]}))})}};c.inheritance.inheritance.inherits(h,c.uiManager.uiManager.UIManager);return h};v("PENGO.client.plugins.uiManager.view");
window.PENGO.client.plugins.uiManager.view.resolve=function(c){return{H:function(g,h){var k=["projectsView","projectDetailView"],f=0;return c.bbWrappers.pengoView.PengoView.extend({tagName:"div",attributes:{"class":"UiManager"},initialize:function(){this.template=_.template(h.module);this.J=_.template(h.MessageDialog);this.model.set({texts:g.i},{Z:!0});this.firstRender()},S:function(){},D:function(){-1!=navigator.userAgent.indexOf("Mac OS X")&&$("body").addClass("mac")},render:function(){this.$el.html(this.template());
this.D();this.addControllerCallbacks();return this},r:function(a){g.g.isFatal()||(this.c(),$("body").find(".ModalView").addClass("show"),$("body").find(".ModalView").removeClass("hidden"),$("body").find(".ModalViewContent").html(a.$el),this.m=!0)},c:function(){g.g.isFatal()||($("body").find(".ModalView").addClass("hidden"),$("body").find(".ModalView").removeClass("show"),$("body").find(".ModalViewContent").contents().detach(),this.m=!1)},h:function(a){function b(){c.m?(d.detach(),f.addClass("show").removeClass("hidden")):
c.c()}var d=$("<div/>"),c=this,f=e;d.addClass("modal-form");a.dialogClass!==e&&d.addClass(a.dialogClass);d.html(this.J());d.find("#title").text(a.title);d.find("#text1").html(a.text.replace(/\n/g,"<br>"));a.button1Text!==e?d.find("#button1").prop("value",a.button1Text):d.find("#button1").remove();a.button1Class!==e&&d.find("#button1").addClass(a.button1Class);a.button2Text!==e?d.find("#button2").prop("value",a.button2Text):d.find("#button2").remove();a.button2Class!==e&&d.find("#button2").addClass(a.button2Class);
!1===a.closeButton&&d.find("#closebutton").remove();a.extra!==e&&d.find(".modal-form-body").append(a.extra);this.m?(f=$("body").find(".ModalViewContent").contents(),f.addClass("hidden").removeClass("show")):$("body").find(".ModalView").addClass("show").removeClass("hidden");$("body").find(".ModalViewContent").children().addClass("hidden").removeClass("show");$("body").find(".ModalViewContent").append(d);d.find("#button1").on("click",function(){b();a.button1Action!==e&&a.button1Action()});d.find("#button2").on("click",
function(){b();a.button2Action!==e&&a.button2Action()});d.find("#closebutton").on("click",function(){b();a.closeButtonAction!==e&&a.closeButtonAction()});if(a.extraActions!==e)for(var g=0;g<a.extraActions.length;g++)if(a.extraActions[g].extraSel!==e&&a.extraActions[g].extraAct!==e)d.find(a.extraActions[g].extraSel).on("click",a.extraActions[g].extraAct)},s:function(){$("body").find("#RootWaitView").show()},l:function(){$("body").find("#RootWaitView").hide()},Y:function(){$("body").find("#RootWaitView").hide()},
t:function(a){var b=this,d=e,c=e,h=k.indexOf(a),m=0;h!==e&&(m=h-f,0!==m&&(this.C=!0,g.a.emit("DASHUIMANAGER_DESKTOP_UNSET",{ID:k[f]}),d=$("#"+k[f]),c=$("#"+k[h]),c.bind("webkitAnimationEnd animationend msAnimationEnd oAnimationEnd animationEnd",function(){d.hide();0>m?(c.removeClass("InLeftDiv"),d.removeClass("OutRightDiv")):(c.removeClass("InRightDiv"),d.removeClass("OutLeftDiv"));c.unbind("webkitAnimationEnd animationend msAnimationEnd oAnimationEnd animationEnd");f=h;b.C=!1;g.a.emit("DASHUIMANAGER_DESKTOP_SET",
{ID:k[f]})}),c.show(),0>m?(d.addClass("OutRightDiv"),c.addClass("InLeftDiv")):(d.addClass("OutLeftDiv"),c.addClass("InRightDiv"))))}})}}};v("PENGO.client.plugins.uiManager.controller");window.PENGO.client.plugins.uiManager.controller.resolve=function(){return function(c){return{K:function(){},q:function(g){var h=_.template(c.z.OverlayWait),k=$("<div/>");k.addClass("overlay-wait");k.append(h());$(g).append(k)},k:function(c){$(c).find(".overlay-wait").remove()}}}};v("PENGO.client.plugins.uiManager.activator");
(function(){function c(){b.off("SERVICE_REGISTERED",c);t=b.getService("igloo.logger")[0];if(!t||!b.getService("igloo.fatal")[0]||!b.getService("languageManager")[0]||!b.getService("igloo.eventsManager")[0]||!b.getService("theme")[0])b.on("SERVICE_REGISTERED",c);else{l||(l=new m.module(p.templates,p.textsURL));try{l.L(p.config,r)}catch(k){b.getService("igloo.fatal")[0].handleFatal({Message:k.message,Source:'Setting plugin "'+b.getPluginId()+'"'})}m.errors.O=p.config.errorsStore;b.getService("support")[0]&&
l.p(b.getService("support")[0]);b.on("SERVICE_REGISTERED",g);b.on("SERVICE_UNREGISTERED",h);l.start(d,t,b.getService("languageManager")[0],b.getService("igloo.eventsManager")[0],b.getService("igloo.fatal")[0],function(c){c?b.getService("igloo.fatal")[0].handleFatal({Message:'Error "'+c.message+'" while starting plugin "'+b.getPluginId()+'"',Source:'Starting plugin "'+b.getPluginId()+'"'}):(s={functions:{showModalView:l.r,hideModalView:l.c,showMessageDialog:l.h,showWaitView:l.s,hideWaitView:l.l,showDomElemWaitView:l.q,
hideDomElemWaitView:l.k},properties:{}},b.register(a,s),b.on("SERVICE_UNREGISTERED",f),b.on("SERVICE_UPDATED",u))},this)}}function g(a){"support"===a&&l.p(b.getService(a)[0])}function h(a){"support"===a&&l.p(b.getService(a)[0])}function k(d,k){s!==e&&b.unregister(a,s);l!==e&&l.stop();b.off("SERVICE_UNREGISTERED",f);b.off("SERVICE_UPDATED",u);if(d&&!k)b.on("SERVICE_REGISTERED",c);else b.off("SERVICE_REGISTERED",c);q.remove(p.errorsStore);b.off("SERVICE_REGISTERED",g);b.off("SERVICE_UNREGISTERED",h)}
function f(a){switch(a){case "languageManager":if(l.o(b.getService("languageManager")[0]))return;break;case "uitools.toolbar":if(l.M(b.getService("uitools.toolbar")[0]))return;break;default:return}k(!0)}var a="uiManager",b,d,r,q,m,p,t,l,s,u=f;window.PENGO.client.plugins.uiManager.activator.activator=function(a,f){q=a.pengoError.pengoError.storage;return{start:function(a,g,h,k){b=a;p=g;d=h;r=k;m=f;q.add(g.config.errorsStore,f.errors.G);c()},stop:k}}})();})();
